YUI.add("moodle-core-searchableselector",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)};e.extend(n,e.Base,{select:null,searchfield:null,selectedlist:null,selecteditems:[],spinner:null,initializer:function(){var t=this,n={},r=this.get("source");try{this.select=e.one("#"+this.get("selectid")),this.searchfield=e.one("#"+this.get("searchfieldid")),this.selectedlist=e.one("#"+this.get("selectedlistid")),this.select&&this.select.hide(),n={resultListLocator:function(e){return t._resultListLocator(e)},resultTextLocator:"name",width:"auto",source:this._get_source()},r!==null&&(n.resultFilters="phraseMatch"),this.searchfield.plug(e.Plugin.AutoComplete,n),this.searchfield.on("keyup",this._show_spinner,this),this.searchfield.ac.on("select",this._item_selected,this),this.searchfield.ac.on("results",this._hide_spinner,this),this.select.all("option:checked").each(function(e){t.select_item(e.getContent(),e.get("value"))})}catch(i){return this._throw_exception(i)}return this},remove_selected_items:function(){try{this.select.setContent(""),this.selectedlist.setContent("");while(this.selecteditems.length>0)this.selecteditems.pop()}catch(e){return this._throw_exception(e)}return!0},select_item:function(t,n){try{this.get("ismultiple")||this.remove_selected_items();var r=this.get("selecteditem_template");if(r!==null)return r(t,n);var i=e.Node.create("<li />").setContent("<span>"+t+"</span>"),s=e.Node.create("<button />").addClass("yui3-button closebutton");s.on("click",function(e){e.preventDefault();var t=this.select.one('option[value="'+n+'"]');t&&t.remove(),e.target.get("parentNode").remove()},this),i.append(s),this.selectedlist.append(i),this.selecteditems.push(n);var o=e.Node.create("<option />").set("text",stripHTML(t)).set("value",parseInt(n)).set("selected","selected");this.select.append(o)}catch(u){return this._throw_exception(u)}return!0},_resultListLocator:function(t){var n=new Array;return e.Object.each(t,function(e,t){this.selecteditems.indexOf(t)===-1&&n.push({name:e,id:t})},this),n},_show_spinner:function(){return this.spinner||(this.spinner=M.util.add_spinner(e,this.searchfield.get("parentNode"))),this.spinner.show(),!0},_hide_spinner:function(){return this.spinner?(this.spinner.hide(),!0):!1},_item_selected:function(t){var n=t.result.raw;return t.preventDefault(),this.searchfield.select(),this.searchfield.ac.hide(),this.select_item(n.name,n.id),e.later(1,this.searchfield.ac,"show",[],!1),!0},_get_source:function(){var e=this.get("source");return e!==null?e:this.get("serverfile")+"?keyword={query}&"+this.get("serverparams")},_throw_exception:function(e){return new M.core.exception({message:e.message,name:e.name,fileName:e.fileName,lineNumber:e.lineNumber,stack:e.stack})}},{NAME:"moodle-core-searchableselector",ATTRS:{selectid:{value:null},searchfieldid:{value:null},selectedlistid:{value:null},serverfile:{value:null},serverparams:{value:null},ismultiple:{value:!1},selecteditem_template:{value:null},source:{value:null}}}),M.core=M.core||{},M.core.init_searchableselector=M.core.init_searchableselector||function(e){return new n(e)}},"@VERSION@",{requires:["base","io","moodle-core-notification","autocomplete","autocomplete-filters"]});
