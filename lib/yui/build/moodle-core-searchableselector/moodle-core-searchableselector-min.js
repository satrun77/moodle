YUI.add("moodle-core-searchableselector",function(e,t){var n=function(){n.superclass.constructor.apply(this,arguments)};e.extend(n,e.Base,{select:null,searchfield:null,selectedlist:null,selecteditems:[],spinner:null,initializer:function(){return config={},source=this.get("source"),this.select=e.one("#"+this.get("selectid")),this.searchfield=e.one("#"+this.get("searchfieldid")),this.selectedlist=e.one("#"+this.get("selectedlistid")),this._check_required_attributes()?(this.select&&this.select.hide(),config={resultListLocator:e.bind("_resultListLocator",this),resultTextLocator:"name",width:"auto",source:this._get_source()},source!==null&&(config.resultFilters="phraseMatch"),this.searchfield.plug(e.Plugin.AutoComplete,config),this.searchfield.on("keyup",this._show_spinner,this),this.searchfield.ac.on("select",this._item_selected,this),this.searchfield.ac.on("results",this._hide_spinner,this),this.select.all("option:checked").each(e.bind(function(e){this.select_item(e.getContent(),e.get("value"))},this)),this):this},remove_selected_items:function(){this.select.setContent(""),this.selectedlist.setContent("");while(this.selecteditems.length>0)this.selecteditems.pop();return this},select_item:function(t,n){this.get("ismultiple")||this.remove_selected_items();var r=this.get("selecteditem_template");if(r!==null)return r.call(this),this;var i=e.Node.create("<li />").setContent("<span>"+t+"</span>"),s=e.Node.create("<button />").addClass("yui3-button closebutton");s.on("click",function(e){e.preventDefault();var t=this.select.one('option[value="'+n+'"]');t&&t.remove(),e.target.get("parentNode").remove();var r=this.selecteditems.indexOf(n);r!==-1&&this.selecteditems.splice(r,1)},this),i.append(s),this.selectedlist.append(i),this.selecteditems.push(n);var o=e.Node.create("<option />").set("text",stripHTML(t)).set("value",parseInt(n,10)).set("selected","selected");return this.select.append(o),this},_resultListLocator:function(t){var n=[];return e.Object.each(t,function(e,t){this.selecteditems.indexOf(t)===-1&&n.push({name:e,id:t})},this),n},_show_spinner:function(){return this.spinner||(this.spinner=M.util.add_spinner(e,this.searchfield.get("parentNode"))),this.spinner.show(),this},_hide_spinner:function(){return this.spinner&&this.spinner.hide(),this},_item_selected:function(t){var n=t.result.raw;t.preventDefault(),this.searchfield.select(),this.searchfield.ac.hide(),this.select_item(n.name,n.id),e.later(1,this.searchfield.ac,"sendRequest",[""],!1),e.later(1,this.searchfield.ac,"show",[],!1)},_get_source:function(){var e=this.get("source");if(e!==null)return e;var t=this.get("serverfile");return t===null&&this._log("Misconfigured 'source' attribute in Y.AutoComplete. The 'serverfile' and 'source' attributes are empty in M.core.searchableselector. One of these attributes should have a valid value.","warn"),t+"?keyword={query}&"+this.get("serverparams")},_check_required_attributes:function(){var e="";return this.select||(e+="- Unable to find the select element.\n"),this.searchfield||(e+="- Unable to find the select search field element.\n"),this.selectedlist||(e+="- Unable to find the container element for the selected items.\n"),e!==""?(this._log(e,"error"),!1):!0},_log:function(e,t){}},{NAME:"moodle-core-searchableselector",ATTRS:{selectid:{value:null},searchfieldid:{value:null},selectedlistid:{value:null},serverfile:{value:null,validator:function(t){return e.Lang.isString(t)&&t.length}},serverparams:{value:null,validator:function(t){return e.Lang.isString(t)&&t.length}},ismultiple:{value:!1,validator:e.Lang.isBoolean},selecteditem_template:{value:null,validator:e.Lang.isFunction},source:{value:null,validator:function(t){return e.Lang.isString(t)&&t.length}}}}),M.core=M.core||{},M.core.searchableselector=M.core.searchableselector||{},M.core.searchableselector.instances=M.core.searchableselector.instances||[],M.core.searchableselector.init=function(e){var t=new n(e);return M.core.searchableselector.instances.push(t),t}},"@VERSION@",{requires:["base","io","moodle-core-notification","autocomplete","autocomplete-filters"]});
